---
title: 'Как готовить макет InDesign для экспорта в EPUB'
date: Tue, 25 Mar 2014 09:38:41 +0000
draft: false
tags: ['epub', 'production']
---

Очень полезная [статья](http://www.pagetoscreen.net/journal/item/indesigncc_print_and_epub) известного специалиста по вёрстке EPUB Криса Дженнингса для издателей, которые не отдают конвертацию своих книг на аутсорсинг, а предпочитают делать их самостоятельно. Ниже привожу её в вольном и расширенном пересказе.

Первый вопрос для них: как? Вроде бы все (ок, почти все) верстают в InDesign, а в InDesign есть Ctrl/Cmd+E — и экспорт в EPUB. Всё просто… Но результат получается не совсем такой или совсем не такой, как хотелось бы. Причина в необходимости правильной подготовки макета, точнее — в правильных принципах вёрстки, которые позволяют создать такой макет, который будет (хотя бы примерно) одинаково приемлем и для вывода PDF на печать, и для экспорта в EPUB без необходимости большой переделки получающегося в результате экспорта кода.

Прежде всего, Дженингс обращает внимание на то, что InDesign — прекрасный WYSIWYG-редактор для PDF, но не для EPUB, поскольку EPUB предполагает некоторые ограничения, которых нет при подготовки PDF, и наоборот. Например — физические параметры макета. Очевидно, что при создании макета бумажной книги первым шагом является выбор размеров печатного блока. Но для подготовки EPUB это практически не имеет значения. Ориентироваться на представление макета в InDesign для просмотра EPUB невозможно — электронная книга всё равно будет выглядеть не так, как напечатанная. В частности, потому, что при конвертации InDesign опустит информацию на мастер-страницах, где при правильной вёрстке дизайнеры размещают колонтитулы, колонцифры и другие регулярные элементы макета. Как правило, программы для чтения EPUB вообще не отображают колонтитулов, но даже iBooks только имитирует колонтитул, черпая информацию для него из тега `title` файла, в которую текст из макета InDesign не попадёт. На это обстоятельство следует обратить внимание тем дизайнерам, которые склонны размещать регулярные элементы оформления макета не на мастер-страницах, а в основной вёрстке. В этом случае при конвертации все эти элементы подверстаются в конец книги, и их придётся вычищать из кода вручную.

Собственно, это следует из самой важной особенности EPUB — отсутствия разбиения на страницы. Если нет страниц, то нет и колонтитулов и пр. Кроме того, нужно с особой аккуратностью относиться к навыкам размещения текста на странице, которые преследуют цель избежать висячих строк в начале и конце абзацев. Стоит рекомендовать дизайнерам отказаться от практики расстановки мягких или, тем более, принудительных переносов: при конвертации они будут отображаться как принудительный перевод строки посредине абзаца. Тех же результатов при подготовке печатного макета, но без последствий для EPUB, можно добиться использованием трекинга или опцией `Keep Together` в настройках абзаца.

Отдельная проблема верстки электронных книг — начать текст с новой полосы. При «бумажной» вёрстке дизайнер в свойствах стиля главы может просто указать `Start on Next page`. При конвертации в EPUB в настройках можно задать именно этот стиль в форме `Split ePub`. В этом случае файл «разрежется» на отдельные главы и каждая глава будет начинаться с той строки, стиль которой был выбран для «разрезания». К сожалению, такой метод работает только для одного стиля, в то время, как дизайн может предполагать «разрезание» по разным стилям. Отчасти эта проблема решается в последней версии InDesign, которая каждый принудительное начало полосы (`Start on Next page`) транслирует в CSS-правило `{page-break-before:always;}`. Возникает, правда, другая — если EPUB будет разрезан по стилю, в свойствах которого уже был перенос на новую полосу, то программа для чтения EPUB может перенести начало сразу на две полосы. Обратите на это внимание и отредактируйте получившийся после конвертации код вручную.

Шрифты — очень важная часть макета книги. И EPUB предоставляет много возможностей для их отображения. Однако не все устройства и программы для чтения позволяют их отображать. В любом случае, InDesign делает всё возможное — программа не только конвертирует макет в EPUB вместе со всеми шрифтами (при условии задания этой настройки), но и вставляет в EPUB метафайл, который инструктирует iBooks пользоваться шрифтами издателя. Всё, что вам нужно, — озаботиться лицензионной чистотой используемого шрифта. Или обойтись шрифтами, распространяемыми под подходящими свободными лицензиями.

Так же, как и в случае с мастер-страницами, некоторые обычные для использования опции типографики при переводе в EPUB работать перестанут, в частности, сдвиг базовой линии, выравнивание по сетке и т. д. На это следует обратить внимание, в частности, оценивая отбивку основного текста от заголовков: текст в EPUB может выглядеть совсем не так, как в макете. Из соображений надёжности имеет смысл использовать настройку `Space Before` и `Space After` в свойствах абзаца.

Особое внимание следует обращать на правила вёрстки иллюстраций. Обычно дизайнеры избегают вставлять графику прямо в текст, резонно опасаясь, что при возможной перевёрстке иллюстрации могут оказаться совсем не на том месте, на котором нужно. Частично решить это проблему может опция `Custom Position` в меню `Anchored Object Options`. Но в любом случае, только иллюстрация, привязанная к якорю внутри текста будет экспортирована именно таким образом, как нужно вам, а не попадёт в конец книги. Кроме того, имейте в виду, что допустимые форматы графики для печати (CMYK и Greyscale) и EPUB (RGB и Grayscale) различаются.

Не забудьте это обстоятельство при подготовке обложки для EPUB: в настройках экспорта вам всё равно нужно будет выбрать вариант — позволить программе растрировать первую страницу макета (а это обычно не обложка, а титульный лист или авантитул), или использовать готовый файл. Который, соответственно, должен быть в формате RGB и пропорциях книжной страницы. Следует заметить, что настроек экспорта графики в EPUB и HTML в последних версиях InDesign заметно прибавилось, но рекомендуется, впрочем, выставлять `Preserve Appearance from Layout` и `Relative to Text Flow`.

Важная рекомендация Дженнингса касается манеры вёрстки: перестаньте вставлять отдельные фреймы! И хотя бы не делайте заголовки отдельными от общего потока текста фреймами. Вам же из них потом делать оглавление. А если уж никак не можете обойтись без «фреймиков», то хотя бы привязываете их якорями к тексту.

Что касается оглавления, то последние версии программы позволяют делать его формировать уже в правильном, то есть интерактивном, виде прямо из «печатного» оглавления, в котором, правда, придется избавиться от номеров страниц (в EPUB фиксированных страниц, сорри за напоминание, нет).

Последняя рекомендация, которую даёт Дженнингс — как можно меньше править в конечном XHTML-коде, а править CSS для книги. InDesign, между прочим, позволяет подключать внешнюю таблицу стилей, что крайне удобно, если вы пользуетесь постоянным набором стилей, например, для серии книг.

P. S. И не забывайте, что имена стилей, экспортируемых из InDesign, нельзя писать по-русски: читалки их могут не понять.